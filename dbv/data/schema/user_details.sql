CREATE VIEW `user_details` AS
select `tbl_users`.`user_id` AS `user_id`,`tbl_users`.`email` AS `email`,`tbl_users`.`password` AS `password`,`tbl_users`.`biometrics_id` AS `biometrics_id`,`tbl_users`.`twofactor_auth` AS `twofactor_auth`,`tbl_users`.`twofactor_secret` AS `twofactor_secret`,`tbl_users`.`token` AS `token`,`tbl_users`.`token_expire` AS `token_expire`,`tbl_users`.`show_inactive` AS `show_inactive`,`tbl_users`.`show_deleted` AS `show_deleted`,`tbl_users`.`country_id` AS `country_id`,`tbl_users`.`created_time` AS `created_time`,`tbl_users`.`last_access_time` AS `last_access_time`,`tbl_users`.`suspended` AS `suspended`,`owner`.`owner_id` AS `id_owner`,`owner`.`first_name` AS `owner_fname`,`owner`.`last_name` AS `owner_lname`,concat_ws(' ',`owner`.`last_name`,`owner`.`first_name`) AS `owner_full_name`,`owner`.`company` AS `company`,`owner`.`profile_photo` AS `owner_photo`,`owner`.`active` AS `owner_active`,`employees`.`employee_id` AS `employee_id`,`employees`.`first_name` AS `first_name`,`employees`.`last_name` AS `last_name`,concat_ws(' ',`employees`.`last_name`,`employees`.`first_name`) AS `full_name`,`employees`.`owner_id` AS `owner_id`,`employees`.`profile_photo` AS `profile_photo`,`employees`.`active` AS `active`,`employees`.`suspended` AS `employee_suspended`,`departments`.`department` AS `department`,`employees`.`department_id` AS `department_id`,(case when ((`tbl_users`.`suspended` = 1) and isnull(`tbl_users`.`password`)) then 'Awaiting Verification' when ((`tbl_users`.`suspended` = 1) and (`tbl_users`.`password` is not null)) then 'Account Suspended by Admin' when (`owner`.`active` = 1) then 'Owner Active' when (`owner`.`active` = 0) then 'Account Suspended by Owner' when (`employees`.`suspended` = 1) then 'Account Suspended by Owner' when ((`employees`.`active` = 1) and (`employees`.`suspended` = 0)) then 'Employee Active' when ((`employees`.`active` = 0) and (`employees`.`suspended` = 0)) then 'Account Suspended by Employee' else 'Incomplete Registration' end) AS `status`,`countries`.`country_name` AS `country_name`,`countries`.`continent` AS `continent`,`countries`.`abbr` AS `abbr`,`countries`.`phone_code` AS `phone_code`,`countries`.`currency_code` AS `currency_code`,(case when (`departments`.`department_id` = 2) then 3 when (`departments`.`department_id` = 1) then 1 when (`departments`.`department_id` = 3) then 2 when (`owner`.`owner_id` is not null) then 4 else 0 end) AS `level` from ((((`tbl_users` left join `owner` on((`tbl_users`.`user_id` = `owner`.`user_id`))) left join `employees` on((`employees`.`user_id` = `tbl_users`.`user_id`))) left join `departments` on((`departments`.`department_id` = `employees`.`department_id`))) left join `countries` on((`countries`.`country_id` = `tbl_users`.`country_id`)))
