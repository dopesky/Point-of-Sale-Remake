CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `purchase_summary` AS select `purchases`.`product_id` AS `product_id`,sum(ifnull(`purchases`.`quantity`,0)) AS `purchase_quantity`,avg(ifnull(`purchases`.`quantity`,0)) AS `average_purchase_quantity`,sum(ifnull(`purchases`.`total_cost`,0)) AS `purchase_cost`,avg(ifnull(`purchases`.`total_cost`,0)) AS `average_purchase_cost_per_purchase`,sum(ifnull(`purchases`.`discount`,0)) AS `discount_received`,avg(ifnull(`purchases`.`discount`,0)) AS `average_discount_received_per_purchase` from (`purchases` left join `payments` `purchase_payments` on(((`purchase_payments`.`payment_id` = `purchases`.`payment_id`) and (ifnull(`purchase_payments`.`suspended`,0) = 0) and (ifnull(`purchase_payments`.`active`,1) = 1)))) where ((`purchases`.`active` = 1) and (`purchases`.`suspended` = 0)) group by `purchases`.`product_id` order by `purchases`.`product_id`