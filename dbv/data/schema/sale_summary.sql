CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `sale_summary` AS select `sales`.`product_id` AS `product_id`,sum(ifnull(`sales`.`quantity`,0)) AS `sale_quantity`,avg(ifnull(`sales`.`quantity`,0)) AS `average_sale_quantity_per_sale`,sum((ifnull(`sales`.`cost_per_item`,0) * ifnull(`sales`.`quantity`,0))) AS `sale_revenue`,avg((ifnull(`sales`.`cost_per_item`,0) * ifnull(`sales`.`quantity`,0))) AS `average_sale_revenue_per_sale`,sum(ifnull(`sales`.`discount`,0)) AS `discount_allowed`,avg(ifnull(`sales`.`discount`,0)) AS `average_discount_allowed_per_sale` from (`sales` left join `payments` `sale_payments` on(((`sale_payments`.`payment_id` = `sales`.`payment_id`) and (ifnull(`sale_payments`.`suspended`,0) = 0) and (ifnull(`sale_payments`.`active`,1) = 1)))) where ((`sales`.`active` = 1) and (`sales`.`suspended` = 0)) group by `sales`.`product_id` order by `sales`.`product_id`